<div class="user-management-page">
    <div class="page-header">
        <h1>User Management</h1>

        <div class="filters">
            <select [(ngModel)]="roleFilter" (change)="applyFilters()">
                <option value="">All Roles</option>
                <option value="ROLE_CUSTOMER">Customer</option>
                <option value="ROLE_TECHNICIAN">Technician</option>
                <option value="ROLE_SERVICE_MANAGER">Service Manager</option>
                <option value="ROLE_ADMIN">Admin</option>
            </select>
            <select [(ngModel)]="statusFilter" (change)="applyFilters()">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="locked">Locked</option>
            </select>
        </div>
    </div>

    <div *ngIf="loading" class="loading-state">
        <p>Loading users...</p>
    </div>

    <div class="users-table-container" *ngIf="!loading && filteredUsers.length > 0">
        <table class="users-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Roles</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of filteredUsers">
                    <td><strong>{{ user.username }}</strong></td>
                    <td>{{ user.firstName }} {{ user.lastName }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phoneNumber }}</td>
                    <td>
                        <div class="roles-list">
                            <span *ngFor="let role of user.roles" class="role-badge">
                                {{ role }}
                            </span>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge" [ngClass]="user.accountLocked ? 'status-locked' : 'status-active'">
                            {{ user.accountLocked ? 'Locked' : 'Active' }}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons" *ngIf="!isCurrentUser(user)">
                            <button *ngIf="!user.accountLocked" (click)="lockUser(user)" class="btn-action btn-lock"
                                title="Lock User">
                                ðŸ”’
                            </button>
                            <button *ngIf="user.accountLocked" (click)="unlockUser(user)" class="btn-action btn-unlock"
                                title="Unlock User">
                                ðŸ”“
                            </button>
                        </div>
                        <span *ngIf="isCurrentUser(user)" class="current-user-label">You</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div *ngIf="!loading && filteredUsers.length === 0" class="empty-state">
        <p>No users found</p>
    </div>
</div>