<div class="bookings-page">
    <div class="page-header">
        <h1>Assigned Bookings</h1>
    </div>

    <!-- Filter Tabs -->
    <div class="tabs">
        <button *ngFor="let status of statusFilters" class="tab" [class.active]="selectedStatus === status"
            (click)="filterByStatus(status)">
            {{ status || 'All' }}
        </button>
    </div>

    <!-- Bookings List -->
    <div class="bookings-list" *ngIf="filteredBookings.length > 0; else noBookings">
        <div *ngFor="let booking of filteredBookings" class="booking-card">
            <div class="booking-header">
                <div>
                    <h3>{{ booking.serviceName }}</h3>
                    <span class="booking-number">{{ booking.bookingNumber }}</span>
                </div>
                <span class="status-badge" [ngClass]="'status-' + booking.status.toLowerCase()">
                    {{ booking.status }}
                </span>
            </div>

            <div class="booking-details">
                <div class="detail-row">
                    <span class="label">Customer</span>
                    <span>{{ booking.customerName }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Phone</span>
                    <span>{{ booking.customerPhone }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Scheduled</span>
                    <span>{{ booking.scheduledDate | date:'medium' }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Location</span>
                    <span>{{ booking.city }}, {{ booking.state }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Priority</span>
                    <span class="priority" [ngClass]="'priority-' + booking.priority.toLowerCase()">
                        {{ booking.priority }}
                    </span>
                </div>
            </div>

            <div class="booking-actions">
                <button class="btn-view" [routerLink]="['/technician/bookings', booking.id]">
                    View Details
                </button>

                <button *ngIf="booking.status === 'ASSIGNED'" class="btn-confirm"
                    (click)="confirmBooking(booking.id, $event)">
                    Confirm
                </button>

                <button *ngIf="booking.status === 'ASSIGNED'" class="btn-reject"
                    (click)="showRejectDialog(booking, $event)">
                    Reject
                </button>

                <button *ngIf="booking.status === 'CONFIRMED'" class="btn-start"
                    (click)="startService(booking.id, $event)">
                    Start Service
                </button>
            </div>
        </div>
    </div>

    <ng-template #noBookings>
        <div class="no-bookings">
            <p>No assigned bookings</p>
        </div>
    </ng-template>

    <!-- Reject Dialog -->
    <div class="modal" *ngIf="showReject" (click)="closeRejectDialog()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h3>Reject Booking</h3>
            <p>Please provide a reason for rejecting this booking:</p>
            <textarea [(ngModel)]="rejectReason" rows="4" class="form-control" placeholder="Enter reason..."></textarea>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="closeRejectDialog()">Cancel</button>
                <button type="button" class="btn-danger" [disabled]="!rejectReason || rejectReason.length < 10"
                    (click)="confirmReject()">
                    Confirm Reject
                </button>
            </div>
        </div>
    </div>
</div>